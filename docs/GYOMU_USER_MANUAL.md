# 生産計画管理システム - 配送管理者向け使用マニュアル

**対象ユーザー:** 配送管理者（gyomu）
**最終更新日:** 2025年10月
**バージョン:** 1.0

---

## 📋 目次

1. [はじめに](#はじめに)
2. [ログイン方法](#ログイン方法)
3. [アクセス可能な機能一覧](#アクセス可能な機能一覧)
4. [各機能の詳細な使い方](#各機能の詳細な使い方)
   - [ダッシュボード](#1-ダッシュボード)
   - [CSV受注取込](#2-csv受注取込)
   - [配送便計画](#3-配送便計画)
   - [納入進度](#4-納入進度)
   - [出荷指示書](#5-出荷指示書)
   - [会社カレンダー](#6-会社カレンダー)
5. [典型的な業務フロー](#典型的な業務フロー)
6. [よくある質問（FAQ）](#よくある質問faq)
7. [トラブルシューティング](#トラブルシューティング)

---
はじめに

このマニュアルは、**配送管理者（gyomu）** ロールを持つユーザー向けに作成されています。

### 配送管理者の役割

配送管理者は、**配送・物流部門**の業務をサポートするために、以下の業務を担当します：

- 受注データのインポート
- トラック積載計画の作成・管理
- 納入進度の確認と実績登録
- 出荷指示書の生成
- 配送スケジュールの最適化

### このマニュアルの使い方

- 各機能の説明には、操作手順とポイントを記載しています
- 困ったときは[トラブルシューティング](#トラブルシューティング)をご確認ください
- わからないことがあれば、システム管理者にお問い合わせください

---

## ログイン方法

### 1. アプリケーションを起動

ブラウザで以下のURLにアクセスします：

```

http:10.0.1.194//:8501
アドレスが変わる場合があります。システム管理者にお問い合わせください


```

または、デスクトップのショートカットからアプリを起動します。

### 2. ログイン画面

ログイン画面で、配布されたユーザー名とパスワードを入力します。

**入力項目:**

- **ユーザー名**: あなたのユーザーID（例: `gyomu`）
- **パスワード**: 初回配布されたパスワード

**セキュリティのポイント:**

- 初回ログイン後は、必ずパスワードを変更してください
- パスワードは他の人に教えないでください
- 離席する際は、必ずログアウトしてください

### 3. ログイン成功

ログインに成功すると、**ダッシュボード画面** が表示されます。

左側のサイドバーに、アクセス可能なページのメニューが表示されます。

---

## アクセス可能な機能一覧

配送管理者（gyomu）は、以下の **6つの機能** にアクセスできます：

| 機能名 | 閲覧 | 編集 | 主な用途 |
|--------|------|------|----------|
| **ダッシュボード** | ✅ | ❌ | 全体の概要確認 |
| **CSV受注取込** | ✅ | ✅ | 受注データのインポート |
| **配送便計画** | ✅ | ✅ | トラック積載計画の作成 |
| **納入進度** | ✅ | ✅ | 進捗管理・実績登録 |
| **出荷指示書** | ✅ | ✅ | 出荷指示書の生成（Tiera様専用） |
| **会社カレンダー** | ✅ | ❌ | 営業日・休日の確認 |

**アクセスできない機能:**

- 製品管理（生産管理者のみ）
- 制限設定（生産管理者のみ）
- 生産計画（生産管理者のみ）
- ユーザー管理（管理者のみ）

---

## 各機能の詳細な使い方

### 1. ダッシュボード

**目的:** 生産計画の全体像を把握するための概要画面

#### できること

- 登録製品数、制約対象製品数の確認
- 総需要量、計画期間の確認
- 製品マトリックス（製品群×検査区分）の確認
- 需要トレンドグラフの確認

#### 操作方法

1. サイドバーから「**ダッシュボード**」を選択
2. 画面上部に4つのメトリクスが表示されます
   - 登録製品数
   - 制約対象製品
   - 総需要量
   - 計画期間

3. **製品マトリックス** で、製品群ごとの需要を確認できます
   - フィルターで期間や製品を絞り込み可能

4. **需要トレンドグラフ** で、時系列の需要変化を確認できます

**ポイント:**

- ダッシュボードは **閲覧専用** です（編集権限なし）
- 配送計画を立てる前に、全体の需要を確認しましょう

---

### 2. CSV受注取込

**目的:** お客様からのCSVファイルを読み込み、受注データとして登録

#### できること

- 受注CSVファイルのアップロード
- CSVデータの検証とプレビュー
- データベースへの一括インポート
- インポート履歴の確認

# 操作方法

# 2-1. CSVファイルのアップロード

1. サイドバーから「**CSV受注取込**」を選択

2. 現在の顧客を確認（久保田様 / ティエラ様）
   - サイドバーの「顧客選択」で切り替え可能

3. 「**📤 ファイルアップロード**」タブを開く

4. 対応フォーマットを確認
   - **久保田様**: Shift-JIS、V2/V3形式
   - **ティエラ様**:
     - 内示CSV: CP932、B17形式
     - 確定CSV: CP932、Y55形式

5. 「**ファイルを選択**」ボタンをクリックし、CSVファイルを選択

6. プレビュー画面でデータを確認
   - 先頭10行が表示されます
   - データが正しいかチェック

7. 「**📥 インポート実行**」ボタンをクリック

8. 完了メッセージを確認
   - 成功: 「✅ 〇〇件のレコードをインポートしました」
   - 失敗: エラーメッセージを確認し、CSVファイルを修正

#### 2-2. インポート履歴の確認

1. 「**📊 インポート履歴**」タブを開く

2. 過去のインポート履歴が表示されます
   - インポート日時
   - ファイル名
   - レコード数
   - ステータス

**ポイント:**
- CSVファイルの **エンコーディング** に注意（Shift-JIS / CP932）
- インポート前に必ず **プレビュー** でデータを確認
- 同じ製品コード×日付のデータは **数量が合算** されます
- エラーが出た場合は、「ℹ️ 使い方」タブの説明を確認

**よくあるエラー:**
- 文字化け → エンコーディングが間違っている
- カラム不足 → フォーマットが正しくない
- 日付エラー → 日付形式が正しくない（YYYYMMDD推奨）

---

### 3. 配送便計画

**目的:** オーダー情報から自動的にトラック積載計画を作成

#### できること
- 積載計画の自動作成
- トラック積載の最適化
- 計画の確認と編集
- 容器・トラック情報の管理
- 検査対象製品の確認

#### 操作方法

#### 3-1. 積載計画の作成

1. サイドバーから「**配送便計画**」を選択

2. 「**📦 積載計画作成**」タブを開く

3. 出荷日を選択（日付ピッカー）

4. 「**🚀 積載計画を作成**」ボタンをクリック

5. 自動的に積載計画が作成されます
   - トラック台数
   - 各トラックの積載内容
   - 積載率

6. 結果を確認
   - トラックごとの積載明細
   - 容量オーバーの警告があれば修正

7. **計画の保存**
   - 「**💾 DBに保存**」ボタンをクリック
   - 計画名が自動生成されます（編集可能）
   - **計画名の形式**: `積載計画_{開始日}_{終了日}_{作成日時}`
   - 例：`積載計画_20251027_20251107_20251029_140054`
     - 20251027: 積載計画の開始日（2025年10月27日）
     - 20251107: 積載計画の終了日（2025年11月7日）
     - 20251029: 計画作成日（2025年10月29日）
     - 140054: 作成時刻（14時00分54秒）

8. **Excel出力（確認用）**
   - 「**📥 Excelダウンロード**」ボタンをクリック
   - **目的**: 積載計画の内容を確認するためのExcelファイル
   - **出力形式**: 「日別」または「週別」を選択
   - **ファイル名の形式**: `積載計画確認用_{出力形式}_{開始日}_{終了日}_{出力日時}.xlsx`
   - 例：`積載計画確認用_日別_20251027_20251107_20251029_140054.xlsx`

   **確認用Excelの特徴:**
   - ✅ 計画内容を確認するための読み取り専用ファイル
   - ✅ 日別または週別のレイアウトで出力
   - ✅ トラック別、製品別の積載情報が含まれます
   - ❌ このファイルを編集してもDBには反映されません
   - ⚠️ **編集が必要な場合は、「Excel修正の取り込み」機能を使用してください**

#### 3-1-1. 計画進度の再計算

積載計画をDBに保存した後、納入進度の計画数量を更新するために「計画進度の再計算」を実行してください。

**目的:**
- 積載計画に基づいて納入進度の「計画数」を最新化
- 手動計画数量が反映されるように更新
- 複数日分の積載計画をまとめて再計算

**操作手順:**

1. 「**📦 積載計画作成**」タブで積載計画を作成

2. 積載計画作成ボタンの下にある「**🔄 計画進度の再計算**」エクスパンダーを開く

3. 再計算する製品を選択
   - **製品コード**: ドロップダウンから製品を選択
   - または、全製品を一括再計算することも可能

4. 再計算期間を設定
   - **再計算開始日**: 計算対象の開始日
   - **再計算終了日**: 計算対象の終了日

5. 再計算を実行
   - **選択製品のみ再計算**: 選択した製品のみ再計算
   - **全製品を再計算**: 期間内の全製品を一括再計算

6. 完了メッセージを確認
   - 「再計算が完了しました」と表示されます

**実行タイミング:**
- ✅ 積載計画を新規作成した後
- ✅ 積載計画を修正（Excel経由または画面上編集）した後
- ✅ 手動計画数量を変更した後
- ✅ 複数日分の積載計画をまとめて作成した後

**注意事項:**
- ⚠️ 計画進度は「計画数」列に反映されます
- ⚠️ 再計算しないと、納入進度画面に積載計画の変更が反映されません
- ⚠️ 全製品を再計算する場合は、処理に時間がかかることがあります

**よくある質問:**

**Q: いつ計画進度の再計算を実行すべき？**
- 積載計画を作成・修正した後は**必ず実行**してください
- 納入進度の「計画数」を最新に保つために必要です

**Q: 選択製品と全製品の違いは？**
- **選択製品**: 特定の製品のみ再計算（早い）
- **全製品**: 期間内の全製品を一括再計算（時間がかかるが確実）

**Q: 再計算を忘れるとどうなる？**
- 納入進度の「計画数」が古いままになります
- 進度管理が不正確になる可能性があります

#### 3-2. 計画の確認と編集

1. 「**📊 計画確認**」タブを開く

2. 「**保存済み計画**」タブを選択

3. 編集したい計画を選択

4. 以下の情報を確認できます：
   - 配送日
   - トラック番号
   - 積載製品リスト
   - 積載重量・体積
   - 積載率

5. **保存済み計画のエクスポート**

保存済みの積載計画をExcelまたはPDF形式でダウンロードできます。

**エクスポート手順:**

1. ドロップダウンから計画を選択
   - 例：`ID 15: 積載計画_20251027_20251107_20251029_140054 (12日, 24便)`

2. 「**📊 出力形式**」セクションで形式を選択
   - **📊 Excel形式**: 詳細データを含むExcelファイル
   - **📄 PDF形式**: 印刷用のPDFファイル

3. 「**⬇️ Excelダウンロード**」または「**⬇️ PDFダウンロード**」ボタンをクリック

**ダウンロードされるファイル名:**
- Excelの場合: `{計画名}.xlsx`
  - 例：`積載計画_20251027_20251107_20251029_140054.xlsx`
- PDFの場合: `{計画名}.pdf`
  - 例：`積載計画_20251027_20251107_20251029_140054.pdf`

**ファイル名の意味:**
- `積載計画`: ファイルの種類
- `20251027`: 計画の開始日（2025年10月27日）
- `20251107`: 計画の終了日（2025年11月7日）
- `20251029`: 計画作成日（2025年10月29日）
- `140054`: 計画作成時刻（14時00分54秒）

**エクスポート形式の使い分け:**

| 形式 | 用途 | 特徴 |
|------|------|------|
| **Excel** | データ分析、詳細確認 | ・全データが表形式で出力<br>・ソート・フィルタが可能<br>・別システムへのデータ連携に便利 |
| **PDF** | 印刷、配布、保管 | ・レイアウトが固定<br>・印刷に最適<br>・現場への配布に便利 |

**「📁 両方出力」ボタン:**
- Excel形式とPDF形式を同時にダウンロードできます
- 保管用とデータ分析用の両方が必要な場合に便利

**⚠️ 注意:**
- エクスポートされるファイルの名前は、DB保存時に設定した計画名と同じになります
- 計画名は「💾 DBに保存」時に自動生成されますが、手動で変更することも可能です

##### 📝 画面上での直接編集

**編集可能な項目：**

| 項目 | 編集可否 | 説明 |
|------|---------|------|
| **製品コード** | ✅ 可能 | 積載する製品コード |
| **製品名** | ✅ 可能 | 製品名 |
| **合計数量** | ✅ 可能 | 積載する製品の合計数量 |
| **納期** | ✅ 可能 | 納品日 |
| 積載日 | ❌ 不可 | 配送日（固定） |
| トラック | ❌ 不可 | トラック番号（固定） |
| 容器数 | ❌ 不可 | 合計数量から自動計算 |
| 体積率(%) | ❌ 不可 | トラックの積載率（自動計算） |

**編集手順：**

1. データテーブル上で編集したいセルを**ダブルクリック**
2. 新しい値を入力
3. **合計数量を変更すると**：
   - 容器数が自動的に再計算されます
   - トラックの体積率も自動更新されます
4. 「**💾 変更を保存**」ボタンをクリック
5. 変更が保存されたことを確認

**注意点：**
- 編集可能な項目のみ変更できます
- 自動計算項目（容器数、体積率）は手動で変更できません
- 保存前に変更内容を確認してください

##### 📊 Excel経由での編集

より柔軟な編集が必要な場合は、Excelファイル経由で編集できます。

**Excel編集で可能な項目：**
- ✅ **コンテナ数（容器数）**
- ✅ **総数量（合計数量）**
- ✅ **納品日（納期）**

**Excel編集の手順：**

1. 「**📦 積載計画作成**」タブを開く

2. 計画を作成（「🚀 積載計画を作成」ボタンをクリック）

3. 計画作成後、「**📥 Excelダウンロード**」ボタンをクリック
   - 「日別」または「週別」の出力形式を選択

4. ダウンロードしたExcelファイルを開く

5. 以下の項目を編集（その他は変更しない）：
   - **コンテナ数**（容器数）
   - **総数量**（合計数量）
   - **納品日**（納期）

6. **重要**: `編集キー`列（または`edit_key`列）は**絶対に変更しない**でください
   - この列は変更を追跡するために必要です

7. Excelファイルを保存

8. 「**Excel修正の取り込み**」セクションにファイルをアップロード

9. 「**Excelの修正を適用**」ボタンをクリック

10. 変更内容が表示されるので確認
    - 変更前と変更後の値が表示されます
    - 何件の変更が反映されたか確認

11. 変更内容に問題がなければ「**💾 DBに保存**」で計画を保存

**Excelで編集する際の注意事項：**
- ⚠️ `編集キー`列は絶対に変更・削除しないでください
- ⚠️ 編集可能な列以外は変更しないでください
- ⚠️ 行の追加・削除は避けてください
- ⚠️ Excelのフォーマットを崩さないでください

##### 🔄 自動計算の仕組み

合計数量を変更すると、以下が自動的に再計算されます：

1. **容器数の計算**
   ```
   容器数 = 切り上げ(合計数量 ÷ 製品の容量)
   ```
   - 例: 合計数量100、製品容量30の場合
   - 容器数 = 切り上げ(100 ÷ 30) = 4個

2. **体積率の計算**
   ```
   体積率(%) = (積載体積 ÷ トラック最大体積) × 100
   ```
   - 積載体積 = 容器の体積 × 容器数
   - トラックごとに自動計算されます

**体積率の目安：**
- 🟢 **0-80%**: 適正範囲
- 🟡 **80-100%**: ほぼ満載
- 🔴 **100%以上**: 積載オーバー（要調整）

#### 3-3. 容器管理

1. 「**🧰 容器管理**」タブを開く

2. 登録されている容器の一覧を確認
   - 容器名
   - 最大重量
   - 最大体積
   - 備考

3. 新規容器を追加する場合：
   - 容器名、最大重量、最大体積を入力
   - 「➕ 容器追加」ボタンをクリック

#### 3-4. トラック管理

1. 「**🚛 トラック管理**」タブを開く

2. 登録されているトラックの一覧を確認
   - トラック番号
   - 最大積載重量
   - 最大積載体積
   - 備考

3. 新規トラックを追加する場合：
   - トラック番号、最大積載重量・体積を入力
   - 「➕ トラック追加」ボタンをクリック

#### 3-5. 検査対象製品の確認

1. 「**🔬 検査対象製品**」タブを開く

2. 期間を選択（デフォルト: 3日前～2週間後）

3. 検査区分が「F」または「$」を含む製品が表示されます
   - 日付
   - オーダーID
   - 製品コード
   - 検査区分
   - 数量

**ポイント:**
- 積載計画は **営業日のみ** 作成されます（会社カレンダーに基づく）
- 容量オーバーの警告が出た場合は、便を分けるか翌日に回します
- 検査対象製品は特別な対応が必要な場合があるため、事前確認が重要

**トラック積載のルール:**
- 最大積載重量と体積の両方をチェック
- 同じ納入先の製品を優先的に同じトラックに積載
- 緊急オーダーを優先

---

### 4. 納入進度

**目的:** 受注から出荷までの進捗を管理し、実績を登録

#### できること
- 納入進度の一覧表示
- 進度のフィルタリング（納期、ステータス、製品など）
- 実績の登録（進度更新）
- 出荷実績の記録
- 社内注文の管理
- Excelエクスポート

#### 操作方法

#### 4-1. 進度一覧の確認

1. サイドバーから「**納入進度**」を選択

2. 「**📊 進度一覧**」タブが開きます

3. サマリー情報を確認
   - 総オーダー数
   - 未出荷
   - 一部出荷
   - 遅延
   - 緊急

4. フィルターで絞り込み
   - **納期（開始）**: 開始日を選択（デフォルト: 1日前）
   - **納期（終了）**: 終了日を選択（デフォルト: 10日後）
   - **ステータス**: 未出荷、計画済、一部出荷、出荷完了から選択
   - **製品コード**: 特定製品で絞り込み
   - **オーダーID**: 特定オーダーで絞り込み

5. 「🔍 検索」ボタンをクリックして結果を表示

6. 進度一覧テーブルを確認
   - オーダーID
   - 製品コード
   - 納期
   - 数量
   - 出荷済数量
   - ステータス
   - 進捗率

7. **手動計画数量の編集**（オプション）

#### 4-1-1. 手動計画数量の一括編集

納入進度一覧の下に「**🖊️ 手動計画数量の一括編集**」セクションがあります。このセクションでは、受注数より優先される積載対象製品数を人間の意思で設定できます。

**使用場面：**
- 受注数とは異なる数量を積載したい場合
- 自動計画（受注数ベース）では対応できない特別な配送要求がある場合
- 顧客からの急な変更依頼に対応する場合
- 在庫調整のため、受注数より多めに出荷したい場合

**操作手順：**

1. 進度一覧テーブルの下にある編集可能なテーブルを確認

2. 編集したい行の「**手動計画**」列をクリック

3. 数量を入力
   - **重要**: 増減分ではなく、**変更後の絶対値**を入力してください
   - 例: 現在100 → 120にしたい場合は「20」ではなく「**120**」と入力

4. キャンセルする場合
   - 「0」を入力するのではなく、セル内の値を**完全に削除**（Deleteキー）してNoneにします
   - 空欄（None）= 手動計画なし

5. 「**手動計画を保存**」ボタンをクリック

6. 更新件数を確認
   - 「〇件の手動計画を更新しました」と表示されます

**テーブルの列構成：**

| 列名 | 編集可否 | 説明 |
|------|---------|------|
| 緊急度 | ❌ 不可 | 🔴遅延、🟡緊急、🟢通常 |
| 製品コード | ❌ 不可 | 製品コード |
| 製品名 | ❌ 不可 | 製品名 |
| 納期 | ❌ 不可 | 納品日 |
| 受注数 | ❌ 不可 | 受注数量 |
| **手動計画** | ✅ **可能** | **受注数より優先される積載対象製品数（人間の意思で設定）** |
| 計画数 | ❌ 不可 | 積載計画作成による生成される数量 |
| 計画進度 | ❌ 不可 | 計画数 - 受注数（自動計算） |
| 出荷済 | ❌ 不可 | 出荷済み数量 |
| 進度 | ❌ 不可 | 出荷済 - 受注数（自動計算） |
| 残数 | ❌ 不可 | 未出荷数量（自動計算） |
| ステータス | ❌ 不可 | 出荷ステータス |

**注意事項：**
- ⚠️ **手動計画列のみ**編集可能です
- ⚠️ 入力値は**絶対値**（増減分ではない）
- ⚠️ キャンセル時は「0」ではなく**値を削除**してNoneにする
- ⚠️ 手動計画を設定すると、積載計画作成時に受注数より優先されます
- ⚠️ 保存後はページが再読み込みされます

**手動計画数量の計算例：**

| ケース | 受注数 | 手動計画 | 計画数（積載対象数） | 説明 |
|--------|--------|---------|---------------------|------|
| 通常 | 100 | (なし) | 100 | 受注数がそのまま積載対象数になる |
| 増量 | 100 | 120 | 120 | 手動計画120が積載対象数になる（受注数より20個多く出荷） |
| 減量 | 100 | 80 | 80 | 手動計画80が積載対象数になる（受注数より20個少なく出荷） |
| キャンセル | 100 | None | 100 | 手動計画を解除し、受注数に戻る |

**よくある質問：**

**Q: 手動計画数の意味は？**
- **手動計画数**: 受注数より優先される、人間の意思で設定した積載対象製品数
- 手動計画数を設定すると、積載計画の生成時に受注数ではなく手動計画数が使われます
- つまり「この製品を何個積載対象にするか」を人間が決めた数量です

**⚠️ 重要な注意点:**
- 手動計画数を入れたとしても**既存の積載計画には反映されません**
- 必ず「**📦 積載計画作成**」タブで**もう一回積載計画を作成してください**

**Q: 手動計画を設定した後の正しい流れは？**
1. 「納入進度」→「📊 進度一覧」タブを開く
2. 手動計画数量を入力（積載対象にしたい数量を設定）
3. 「**手動計画を保存**」ボタンをクリック
4. 「**📦 積載計画作成**」タブを開く
5. 「**🚀 積載計画を作成**」ボタンをクリック
6. → 手動計画数量が積載対象数として使われた新しい積載計画が作成されます

**Q: 手動計画と自動計画の違いは？**
- **自動計画**: 受注数量がそのまま積載対象数量として使われる（システム自動）
- **手動計画**: 人間が意図的に設定した数量が積載対象数量として使われる（受注数より優先）
- 手動計画を設定すると、積載計画作成時に受注数ではなく手動計画数が採用されます

**Q: 間違って入力した場合は？**
- 値を削除してNoneにし、再度「手動計画を保存」をクリック
- その後、**積載計画を再作成**してください

---

#### 納入進度一覧のポイント

**表示期間：**
- デフォルトで **過去1日～未来10日** を表示
- フィルターで期間を変更できます

**緊急度の表示：**
- 🔴 遅延: 納期を過ぎているが未出荷
- 🟡 緊急: 納期まで0～3日以内
- 🟢 通常: それ以外

**その他：**
- Excel出力で外部報告用のデータを作成できます
- 製品群フィルターで特定製品群のみ表示できます

---

#### 4-2. 実績登録（積込実績登録）

「✅ 実績登録」タブでは、積載計画に基づいた実績数量を登録できます。

**操作手順：**

1. 「**✅ 実績登録**」タブを開く

2. **積込日を選択**
   - 日付ピッカーで実績を登録したい積込日を選択

3. **トラックを選択**
   - ドロップダウンから該当のトラックを選択

4. 積載計画が表示されます
   - 選択した積込日とトラックの積載計画明細が表示されます

5. **実績数量を確認・修正**
   - 「実績数量」列をダブルクリックして編集
   - 計画数量をベースに、実際に積載した数量を入力
   - 誤差があれば実績数量を修正してください
   - 積載しなかった製品は「0」のまま

6. ドライバー名を入力（オプション）

7. 備考を入力（オプション）

8. 「**実績を登録**」ボタンをクリック

9. 登録完了メッセージを確認
   - 「〇件の実績を登録しました」と表示されます

**テーブルの列構成：**

| 列名 | 編集可否 | 説明 |
|------|---------|------|
| 積込順 | ❌ 不可 | トラックへの積込順序 |
| 製品コード | ❌ 不可 | 製品コード |
| 製品名 | ❌ 不可 | 製品名 |
| 納入日 | ❌ 不可 | 納品日 |
| 計画数量 | ❌ 不可 | 積載計画での数量 |
| 既出荷数量 | ❌ 不可 | すでに出荷済みの数量 |
| **実績数量** | ✅ **可能** | **実際に積載した数量** |

**注意事項：**
- ⚠️ 積込日とトラックを選択すると、該当する積載計画が自動表示されます
- ⚠️ 実績数量は計画数量をベースに初期値が設定されます
- ⚠️ 実際に積載しなかった製品は実績数量を「0」にしてください
- ⚠️ 実績数量を入力すると、納入進度の「出荷済数量」に反映されます
- ⚠️ 納入進度が見つからない明細がある場合は警告が表示されます

**よくある質問：**

**Q: 計画数量と実績数量が異なる場合は？**
- 実績数量をダブルクリックして、実際に積載した数量を入力してください
- 例: 計画100個だが実際は95個積載 → 実績数量に「95」と入力

**Q: 積載しなかった製品はどうする？**
- 実績数量を「0」のままにしてください
- 0の行は実績登録されません

**Q: 複数便がある場合は？**
- 積込順で表示されるので、順番に実績数量を入力してください

#### 4-2-1. 実績進度の再計算

出荷実績を登録した後、納入進度の出荷済数量を更新するために「実績進度の再計算」を実行します。

**目的:**
- 出荷実績に基づいて納入進度の「出荷済」を最新化
- 出荷済数量（shipped_remaining_quantity）を正確に計算
- 複数日分の出荷実績をまとめて再計算

**操作手順:**

1. 「**✅ 実績登録**」タブで出荷実績を登録

2. 登録フォームの下にある「**🔄 実績進度の再計算**」エクスパンダーを開く

3. 再計算する製品を選択
   - **製品コード**: ドロップダウンから製品を選択
   - または、全製品を一括再計算することも可能

4. 再計算期間を設定
   - **再計算開始日（実績）**: 計算対象の開始日
   - **再計算終了日（実績）**: 計算対象の終了日

5. 再計算を実行
   - **選択製品の実績進度を再計算**: 選択した製品のみ再計算
   - **全製品の実績進度を再計算**: 期間内の全製品を一括再計算

6. 完了メッセージを確認
   - 「実績進度の再計算が完了しました」と表示されます

**実行タイミング:**
- ✅ 出荷実績を登録した後（**必須**）
- ✅ 過去の出荷実績を修正した後
- ✅ 複数日分の実績をまとめて登録した後

**注意事項:**
- ⚠️ 実績進度は「出荷済」列に反映されます
- ⚠️ **再計算しないと、納入進度画面に出荷実績が反映されません**
- ⚠️ 全製品を再計算する場合は、処理に時間がかかることがあります
- ⚠️ 「📊 進度一覧」タブにも同じ機能があります

**よくある質問:**

**Q: いつ実績進度の再計算を実行すべき？**
- 出荷実績を登録した後は**必ず実行**してください
- 納入進度の「出荷済」を最新に保つために必要です
- **重要**: 再計算しないと進度管理が不正確になります

**Q: 計画進度と実績進度の違いは？**
- **計画進度の再計算**: 積載計画に基づく「計画数」を更新（配送便計画ページで実行）
- **実績進度の再計算**: 出荷実績に基づく「出荷済」を更新（納入進度ページで実行）

**Q: 選択製品と全製品の違いは？**
- **選択製品**: 特定の製品のみ再計算（早い）
- **全製品**: 期間内の全製品を一括再計算（時間がかかるが確実）

**Q: 再計算を忘れるとどうなる？**
- 納入進度の「出荷済」が古いままになります
- 残数や進捗率が不正確になります
- 遅延や緊急のアラートが正しく表示されません

**Q: 実績登録タブと進度一覧タブ、どちらで再計算すべき？**
- **実績登録タブ**: 実績登録の直後に使うと便利
- **進度一覧タブ**: 一覧を確認しながら再計算したい場合に使用
- どちらも同じ機能なので、使いやすい方を選んでください

#### 4-3. 新規登録

1. 「**➕ 新規登録**」タブを開く

2. 必要な情報を入力
   - オーダーID
   - 製品コード
   - 納期
   - 数量
   - その他の情報

3. 「➕ 登録」ボタンをクリック

#### 4-4. 出荷実績の確認

1. 「**📦 出荷実績**」タブを開く

2. 期間を選択して出荷実績を検索

3. 出荷済みオーダーの一覧が表示されます
   - 出荷日
   - オーダーID
   - 製品コード
   - 出荷数量
   - 納入先

4. 「📥 Excel出力」ボタンで出荷実績をダウンロード

#### 4-5. 社内注文

「🏭 社内注文」タブでは、積載計画で設定された数量を社内向けの加工指示として確認できます。

**操作手順：**

1. 「**🏭 社内注文**」タブを開く

2. **表示期間を選択**（積載日基準）
   - 開始日（積載日）: デフォルトは本日
   - 終了日（積載日）: デフォルトは7日後

3. **製品別マトリクスを確認**
   - 横軸: 積載日
   - 縦軸: 製品コード
   - 各セル: 積載計画数量

4. **Excel出力**
   - 「📥 ダウンロード」ボタンをクリック
   - ファイル名: `社内注文_YYYYMMDD_YYYYMMDD.xlsx`

**機能の目的：**
- 積載計画で設定された数量を社内の製造部門向けに出力
- 製品別×日付別のマトリクス形式で表示
- 加工指示書として活用できます

**ポイント:**
- 積載計画数量が設定されている製品のみ表示されます
- 製品マスタの表示順序に従って並び替えられます
- Excel出力で製造部門に共有できます

---

### 5. 出荷指示書

**目的:** 受注データから出荷指示書PDF を生成

**注意:** この機能は **Tiera様専用** です。

#### できること
- 指定日の出荷データを取得
- 4便分の出荷指示書を生成（1便、2便、3便、4便）
- PDFファイルの出力

#### 操作方法

#### 5-1. 顧客をTieraに切り替え

1. サイドバーの「**顧客選択**」で「**Tiera**」を選択

2. 「**📋 出荷指示書**」ページを開く

#### 5-2. 出荷指示書の生成

1. 出荷日を選択（日付ピッカー）
   - デフォルト: 翌日

2. 「**📊 データ取得**」ボタンをクリック

3. 4便のデータが表示されます
   - 1便: （品目未定）
   - 2便: ブレード
   - 3便: シートベース、タンク
   - 4便: （品目未定）

4. データを確認
   - 各便の製品リスト
   - 数量
   - 備考

5. 「**📄 PDF生成**」ボタンをクリック

6. PDFファイルが生成されます
   - 保存先: `d:/ts_pm_all/output/shipping_orders/`（将来変更する可能性ある）
   - ファイル名: `出荷指示書_YYYYMMDD.pdf`

7. 生成されたPDFをダウンロードまたは印刷

**ポイント:**
- Tiera様専用機能のため、久保田様では使用できません
- PDFは出荷日ごとに1ファイル生成されます
- 出荷指示書には、ブレード、ベースタンクなどの製品群ごとにページが分かれます

---

### 6. 会社カレンダー

**目的:** 会社のExcelカレンダーを確認し、営業日・休日を把握

#### できること
- カレンダーの閲覧
- 月別・年別の表示
- 年間サマリーの確認

**注意:** 配送管理者は **閲覧のみ** です（編集権限なし）

#### 操作方法

#### 6-1. カレンダー表示

1. サイドバーから「**📅 会社カレンダー**」を選択

2. 「**📆 カレンダー表示**」タブを開く

3. 年と月を選択

4. カレンダーが表示されます
   - 緑色: 営業日（「出」）
   - 赤色: 休日（「休」）
   - 備考欄に祝日名や特記事項

5. 特定日をクリックすると詳細が表示されます

#### 6-2. 年間サマリー

1. 「**📊 年間サマリー**」タブを開く

2. 年を選択

3. 月別の営業日数・休日数が表示されます

4. 年間の合計も確認できます

**ポイント:**
- カレンダーは配送計画の基準となります
- 営業日のみトラック配送が計画されます
- 祝日や特別休日の確認に使用
- カレンダーの編集が必要な場合は、管理者に依頼してください

---

## 典型的な業務フロー

配送管理者の日常業務の流れを説明します。

### 📅 毎朝の作業（日次）

#### 1. システムにログイン
- ブラウザでアプリを開き、ログイン

#### 2. ダッシュボードで全体確認
- 総需要量、計画期間を確認
- 異常値がないかチェック

#### 3. 受注データの取込（お客様からCSVを受信した場合）
- 「CSV受注取込」ページを開く
- CSVファイルをアップロード
- データを確認してインポート実行
- 詳細は「📦 受注取込時の作業」セクションを参照

#### 4. 前日の出荷実績を入力
- 「納入進度」→「✅ 実績登録」タブを開く
- 積込日とトラックを選択
- 実績数量を入力して登録
- **⚠️ 重要**: 実績登録後は「**実績進度の再計算**」を実行
  - 登録フォームの下にある「実績進度の再計算」エクスパンダーを開く
  - 「全製品の実績進度を再計算」をクリック
  - ※「📊 進度一覧」タブでも同じ操作が可能
- 詳細は「🚚 配送実績登録時の作業」セクションを参照

#### 5. 納入進度を確認
- 本日出荷予定のオーダーを確認
- 遅延オーダー（🔴）があれば対応
- 緊急オーダー（🟡）を確認

#### 6. 配送便計画を作成（翌日分）
- 「配送便計画」→「📦 積載計画作成」タブを開く
- 翌日の出荷日で積載計画を作成
- トラック台数と積載内容を確認
- 容量オーバーがあれば調整
- 計画をDBに保存
- **⚠️ 重要**: 積載計画作成後は「**計画進度の再計算**」を実行
  - 積載計画作成ボタンの下にある「計画進度の再計算」エクスパンダーを開く
  - 「全製品を再計算」をクリック
  - 納入進度の「計画数」が最新化されます

#### 7. 出荷指示書を生成（Tiera様のみ）
- 「📋 出荷指示書」ページを開く
- 翌日の出荷日でPDFを生成
- 生成されたPDFを現場に配布

---

### 📦 受注取込時の作業（毎日）

#### 1. お客様からCSVファイルを受領
- メール添付またはお客様サイトから取得

#### 2. CSVファイルをアップロード
- 「CSV受注取込」ページを開く
- 顧客を確認（久保田様/Tiera様）
- CSVファイルを選択してアップロード

#### 3. プレビューで確認
- データが正しいかチェック
- 文字化けやエラーがないか確認

#### 4. インポート実行
- 「インポート実行」ボタンをクリック
- 完了メッセージを確認

#### 5. 納入進度で確認
- インポートされたオーダーが表示されるか確認

---

### 🚚 配送実績登録時の作業（日次）

#### 1. 納入進度ページを開く
- サイドバーから「納入進度」を選択

#### 2. 「✅ 実績登録」タブを開く

#### 3. 積込日を選択
- 日付ピッカーで実績を登録したい積込日を選択
- 通常は前日または本日を選択

#### 4. トラックを選択
- ドロップダウンから該当のトラックを選択
- 積載計画明細が自動表示されます

#### 5. 実績数量を入力
- 「実績数量」列をダブルクリックして編集
- 計画数量と実際の数量が異なる場合は修正
- 積載しなかった製品は「0」のまま

#### 6. ドライバー名・備考を入力（オプション）

#### 7. 「実績を登録」ボタンをクリック
- 登録完了メッセージを確認

#### 8. **⚠️ 重要: 実績進度の再計算を実行**
- **方法1**: 「✅ 実績登録」タブで直接再計算（推奨）
  - 登録フォームの下にある「🔄 実績進度の再計算」エクスパンダーを開く
  - 「全製品の実績進度を再計算」ボタンをクリック
  - 再計算完了メッセージを確認
- **方法2**: 「📊 進度一覧」タブで再計算
  - 「📊 進度一覧」タブに移動
  - 「実績進度の再計算（shipped_remaining_quantity）」エクスパンダーを開く
  - 「全製品の実績進度を再計算」ボタンをクリック
  - 再計算完了メッセージを確認

**注意:**
- 実績登録後は必ず実績進度の再計算を実行してください
- 再計算しないと納入進度の「出荷済数量」や「残数」が正しく更新されません
- どちらの方法でも同じ結果が得られます

---

### 📊 月末の作業（月次）

#### 1. 出荷実績をExcel出力
- 「納入進度」→「出荷実績」タブ
- 当月の期間を選択
- 「Excel出力」ボタンでダウンロード

#### 2. 月次報告書を作成
- 出荷実績データをもとに報告書を作成
- トラック台数、配送回数などを集計

#### 3. 次月のカレンダー確認
- 「会社カレンダー」で次月の営業日を確認
- 連休などの特別日程をチェック

---

## よくある質問（FAQ）

### Q1. ログインできません

**A:** 以下を確認してください：
- ユーザー名とパスワードが正しいか
- アカウントが有効化されているか（管理者に確認）
- CapsLockがオンになっていないか

### Q2. CSVインポートで文字化けします

**A:** エンコーディングを確認してください：
- 久保田様: **Shift-JIS** 形式
- Tiera様: **CP932** 形式

CSVファイルをメモ帳で開き、「名前を付けて保存」で正しいエンコーディングを選択してください。

### Q3. 積載計画でトラックが足りません

**A:** 以下の対応を検討してください：
1. 「トラック管理」で新しいトラックを追加
2. 出荷日を分散（一部を翌日に回す）
3. 大型トラックの手配を検討

### Q4. 納入進度で遅延オーダーが表示されます

**A:** 遅延オーダーの対応：
1. 納期を確認（本当に遅延か？）
2. 生産部門に進捗を確認
3. お客様に連絡が必要か判断
4. 必要に応じて管理者に報告

### Q5. 出荷指示書が生成できません

**A:** 以下を確認してください：
- 顧客が「Tiera」になっているか（サイドバーで確認）
- 選択した日付にdelivery_progressのデータがあるか
- 出力フォルダの書き込み権限があるか

### Q6. 実績登録したのにステータスが変わりません

**A:** 以下を確認してください：
- 出荷数量が正しく入力されているか
- オーダー数量と出荷数量の関係
  - 一部出荷: 0 < 出荷数量 < オーダー数量
  - 出荷完了: 出荷数量 ≥ オーダー数量
- ブラウザを更新してみる

### Q7. カレンダーを編集したいのですが

**A:** 配送管理者は閲覧権限のみです。カレンダーの編集が必要な場合は、管理者に依頼してください。

### Q8. 検査対象製品（F/$）とは何ですか？

**A:** 検査区分が「F」または「$」を含む製品は、特別な検査が必要な製品です。出荷前に品質チェックが必要な場合があるため、「配送便計画」→「検査対象製品」タブで事前確認してください。

### Q9. 複数の顧客を同時に管理できますか？

**A:** 現在、同時に複数顧客を表示することはできません。顧客を切り替える場合は、サイドバーの「顧客選択」で切り替えてください。切り替えるとデータベースが切り替わります。

### Q10. Excel出力したファイルが開けません

**A:** 以下を確認してください：
- Excelがインストールされているか
- ファイルがダウンロード完了しているか
- ブラウザのダウンロード設定を確認

---

## トラブルシューティング

### 🔴 エラー: 「データベース接続エラー」

**原因:**
- データベースサーバーが起動していない
- ネットワーク接続の問題
- データベース認証情報が正しくない

**対処法:**
1. ネットワーク接続を確認
2. システム管理者に連絡
3. アプリを再起動

---

### 🔴 エラー: 「アクセス権限がありません」

**原因:**
- 該当ページへのアクセス権限がない
- ロールが正しく割り当てられていない

**対処法:**
1. 自分のロールを確認（管理者に問い合わせ）
2. 必要に応じて管理者に権限追加を依頼

---

### 🔴 エラー: 「CSVインポート失敗」

**原因:**
- CSVフォーマットが正しくない
- エンコーディングが間違っている
- 必須カラムが不足している
- データ型が正しくない（日付、数値など）

**対処法:**
1. 「ℹ️ 使い方」タブでフォーマット仕様を確認
2. CSVファイルをExcelで開き、データを確認
3. エンコーディングを確認（Shift-JIS / CP932）
4. サンプルCSVと比較
5. エラーメッセージの詳細を確認

---

### 🔴 エラー: 「積載計画作成失敗」

**原因:**
- 選択した日付にオーダーデータがない
- トラック情報が登録されていない
- 容器情報が登録されていない

**対処法:**
1. 納入進度で該当日のオーダーがあるか確認
2. 「トラック管理」でトラックが登録されているか確認
3. 「容器管理」で容器が登録されているか確認

---

### 🔴 画面が真っ白になる

**原因:**
- セッションタイムアウト
- ブラウザのキャッシュ問題
- JavaScriptエラー

**対処法:**
1. ブラウザを更新（F5キー）
2. ブラウザのキャッシュをクリア
3. 再ログイン
4. ブラウザを再起動

---

### 🔴 動作が遅い

**原因:**
- 大量データの読み込み
- ネットワークの遅延
- サーバーの負荷

**対処法:**
1. フィルター機能を使ってデータを絞り込む
2. 期間を短く設定
3. 不要なタブを閉じる
4. ピーク時間を避けて使用

---

### 📞 サポート連絡先

上記の対処法で解決しない場合は、システム管理者にお問い合わせください。

**連絡時に伝える情報:**
- ユーザー名
- 発生した日時
- 操作内容（何をしようとしていたか）
- エラーメッセージ（スクリーンショットがあれば添付）
- 使用しているブラウザ

---

## 付録: ショートカットキー

以下のショートカットキーが使用できます（一部ブラウザで異なる場合があります）：

| キー | 動作 |
|------|------|
| **F5** | ページ更新 |
| **Ctrl + S** | データ保存（一部の画面） |
| **Ctrl + F** | ページ内検索 |
| **Esc** | ダイアログを閉じる |

---

## 改訂履歴

| バージョン | 日付 | 内容 |
|-----------|------|------|
| 1.0 | 2025-10 | 初版作成 |

---

**このマニュアルについてご不明な点があれば、システム管理者までお問い合わせください。**
